!function(root,globalName){function RequestManager(){var currentUrl;Object.defineProperty(this,"currentUrl",{get:function(){return this.checkCurrentUrl(document.location.href)},set:function(url){return this.checkCurrentUrl(url)}}),this.validateUrl=function validateUrl(url){if(!url)return!1;if(0==url.indexOf("http")){var thisUrlDetails=this.parseUri(url),thisUrlTLD=thisUrlDetails.tld;if(this.currentUrl.tld!=thisUrlTLD&&-1==this.whitelistDomains.indexOf(thisUrlTLD)||this.blacklistDomains.indexOf(thisUrlDetails.host)>-1)return!0}return!1},this.checkUrl=function checkUrl(url){return this.validateUrl(url)&&(url=this.sanitizeUrl(url)),url},this.intercept=function intercept(){this.interceptDOM(),this.interceptXHR(),this.interceptFetch(),this.interceptSendBeacon()},this.restore=function restore(){this.restoreDOM(),this.restoreXHR(),this.restoreFetch(),this.restoreSendBeacon()}}var rmproto=RequestManager.prototype;rmproto.whitelistKeys=[],rmproto.whitelistDomains=[],rmproto.blacklistDomains=[],rmproto.checkCurrentUrl=function checkCurrentUrl(url){url&&(url=this.parseUri(url));var outArray=urlQSArray=hashArray=[];url.query&&(urlQSArray=url.query.split("&"));var hash=url.anchor?url.anchor.split("?")[1]:void 0;hash&&hash.length>0&&hash.indexOf("=")>-1&&(hashArray=hash.split("&")),outArray=[].concat(urlQSArray,hashArray),this.whitelistKeys=this.whitelistKeys||[];for(var newQSList=[],index=0;index<outArray.length;index++){var element=outArray[index];if(element&&element.indexOf("=")>-1){var key=element.replace(/=.*/,"");-1==this.whitelistKeys.indexOf(key)&&(newQSList.push(element),newQSList.push(encodeURIComponent(element)))}}outArray=newQSList,url.qslist=outArray&&outArray.length>0?outArray:void 0;var qstring=outArray?"("+outArray.join("|")+")":void 0;return url.qsrx=qstring&&"(|)"!=qstring&&"()"!=qstring?new RegExp(qstring,"gmi"):void 0,url},rmproto.parseUri=function parseUri(str){for(var key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],m=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(str),uri={},i=14,h;i--;)uri[key[i]]=m[i]||"";return uri.qs={},uri.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){$1&&(uri.qs[$1]=$2)}),uri.tld=((h=(h=uri.host)?h.split("."):[]).length>2&&(h=[h[h.length-2],h[h.length-1]]),h.join(".")),uri},rmproto.sanitizeUrl=function sanitizeUrl(url){var outurl=url,regx=this.currentUrl.qsrx;return url?(regx&&(outurl=url.replace(regx,function sanitizeReplace(){var value=arguments[0];return 3==(value=value.split(/(%3D|=)/)).length&&value.pop(),value.push("x"),value=value.join("")})),outurl):url},rmproto.interceptDOM=function interceptDOM(){var that=this;if(rmproto._interceptDOM)return!0;for(var _interceptDOM={},DOMELEMENTS=["HTMLImageElement","HTMLIFrameElement","HTMLScriptElement"],index=0;index<DOMELEMENTS.length;index++){var element=DOMELEMENTS[index];_interceptDOM[element]=Object.getOwnPropertyDescriptor(window[element].prototype,"src"),Object.defineProperty(window[element].prototype,"src",{configurable:!0,set:srcHandler})}function srcHandler(src){var url=that.checkUrl(src);url&&this.setAttribute("src",url)}return rmproto._interceptDOM=_interceptDOM,this},rmproto.restoreDOM=function restoreDOM(){if(rmproto._interceptDOM)for(var key in rmproto._interceptDOM)if(rmproto._interceptDOM.hasOwnProperty(key)){var element=rmproto._interceptDOM[key];Object.defineProperty(window[key].prototype,"src",element)}},rmproto.interceptFetch=function interceptFetch(){var that=this;if(!("fetch"in window&&"function"==typeof window.fetch)||this._fetch)return!1;rmproto._fetch=window.fetch,window.fetch=function interceptFetch(url,options){return url&&(url=that.checkUrl(url)),that._fetch.apply(this,[url,options])}},rmproto.restoreFetch=function restoreFetch(){window.fetch=this._fetch},rmproto.interceptSendBeacon=function interceptSendBeacon(){if(!window.navigator||!window.navigator.sendBeacon||"function"!=typeof window.navigator.sendBeacon||this._navigatorSendBeacon)return!1;var that=this;rmproto._navigatorSendBeacon=window.navigator.sendBeacon,window.navigator.sendBeacon=function interceptNavigatorSendBeacon(url,data){return url&&(url=that.checkUrl(url)),that._navigatorSendBeacon.apply(this,[url,data])}},rmproto.restoreSendBeacon=function restoreBeacon(){this._navigatorSendBeacon&&(window.navigator.sendBeacon=this._navigatorSendBeacon)},rmproto.interceptXHR=function interceptXHR(urlmatch,callback,once){var that=this;rmproto._XHROpen=XMLHttpRequest.prototype.open,rmproto._XHRSend=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=function interceptOpen(method,url,async,user,password){void 0===async&&(async=!0),url&&(this._originalUrl=url,url=that.checkUrl(url)),that._XHROpen.apply(this,[method,url,async,user,password])},XMLHttpRequest.prototype.send=function interceptSend(body){var url=this.responseURL||this._originalUrl;body&&"string"==typeof body&&url&&that.validateUrl(url)&&(body=that.sanitizeUrl(body)),that._XHRSend.apply(this,[body])}},rmproto.restoreXHR=function restoreXHR(){this._XHROpen&&(XMLHttpRequest.prototype.open=this._XHROpen),this._XHRSend&&(XMLHttpRequest.prototype.send=this._XHRSend)},globalName=globalName||"_rqmgr",window[globalName]=new RequestManager}(window,"_rqmgr");