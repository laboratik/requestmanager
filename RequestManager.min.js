!function(root,globalName){function RequestManager(){var currentUrl;Object.defineProperty(this,"currentUrl",{get:function(){return this.checkCurrentUrl(document.location.href)},set:function(url){return this.checkCurrentUrl(url)}}),this.checkUrl=function checkUrl(url){if(!url)return url;if(0==url.indexOf("http")){var thisUrlDetails,thisUrlTLD=this.parseUri(url).tld;this.currentUrl.tld!=thisUrlTLD&&(url=this.sanitizeUrl(url))}return url},this.intercept=function intercept(){this.interceptDOM(),this.interceptXHR(),this.interceptFetch(),this.interceptSendBeacon()},this.restore=function restore(){this.restoreDOM(),this.restoreXHR(),this.restoreFetch(),this.restoreSendBeacon()}}var rmproto=RequestManager.prototype;rmproto.whitelistKeys=[],rmproto.checkCurrentUrl=function checkCurrentUrl(url){if(url&&(url=this.parseUri(url)),this.whitelistKeys.length){var currentQS=url.qs,newQSList={};for(var key in currentQS)currentQS.hasOwnProperty(key)&&(this.whitelistKeys.indexOf(key)||(newQSList[key]=currentQS[key]));url.qs=newQSList}return url},rmproto.parseUri=function parseUri(str){for(var key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],m=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(str),uri={},i=14,h;i--;)uri[key[i]]=m[i]||"";return uri.qs={},uri.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){$1&&(uri.qs[$1]=$2)}),uri.tld=((h=(h=uri.host)?h.split("."):[]).length>2&&(h=[h[h.length-2],h[h.length-1]]),h.join(".")),uri},rmproto.sanitizeUrl=function sanitizeUrl(url){var srcurl=url,PIIDATA=this.currentUrl.qs;for(var key in PIIDATA)if(PIIDATA.hasOwnProperty(key)){var element,combo=key+"="+PIIDATA[key];srcurl.indexOf(combo)>-1&&(srcurl=srcurl.replace(combo,key+"=X")),combo=encodeURIComponent(combo),srcurl.indexOf(combo)>-1&&(srcurl=srcurl.replace(combo,encodeURIComponent(key+"=X")))}return srcurl},rmproto.interceptDOM=function interceptDOM(){var that=this;if(rmproto._interceptDOM)return!0;for(var _interceptDOM={},DOMELEMENTS=["HTMLImageElement","HTMLIFrameElement","HTMLScriptElement"],index=0;index<DOMELEMENTS.length;index++){var element=DOMELEMENTS[index];_interceptDOM[element]=Object.getOwnPropertyDescriptor(window[element].prototype,"src"),Object.defineProperty(window[element].prototype,"src",{configurable:!0,set:srcHandler})}function srcHandler(src){var url=that.checkUrl(src);url&&this.setAttribute("src",url)}return rmproto._interceptDOM=_interceptDOM,this},rmproto.restoreDOM=function restoreDOM(){if(rmproto._interceptDOM)for(var key in rmproto._interceptDOM)if(rmproto._interceptDOM.hasOwnProperty(key)){var element=rmproto._interceptDOM[key];Object.defineProperty(window[key].prototype,"src",element)}},rmproto.interceptFetch=function interceptFetch(){var that=this;if(!("fetch"in window&&"function"==typeof window.fetch)||this._fetch)return!1;rmproto._fetch=window.fetch,window.fetch=function interceptFetch(url,options){return url&&(url=that.checkUrl(url)),that._fetch.apply(this,[url,options])}},rmproto.restoreFetch=function restoreFetch(){window.fetch=this._fetch},rmproto.interceptSendBeacon=function interceptSendBeacon(){if(!window.navigator||!window.navigator.sendBeacon||"function"!=typeof window.navigator.sendBeacon||this._navigatorSendBeacon)return!1;var that=this;rmproto._navigatorSendBeacon=window.navigator.sendBeacon,window.navigator.sendBeacon=function interceptNavigatorSendBeacon(url,data){return url&&(url=that.checkUrl(url)),that._navigatorSendBeacon.apply(this,[url,data])}},rmproto.restoreSendBeacon=function restoreBeacon(){this._navigatorSendBeacon&&(window.navigator.sendBeacon=this._navigatorSendBeacon)},rmproto.interceptXHR=function interceptXHR(urlmatch,callback,once){var that=this;rmproto._XHROpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function interceptOpen(method,url,async,user,password){url&&(url=that.checkUrl(url)),that._XHROpen.apply(this,[method,url,async,user,password])}},rmproto.restoreXHR=function restoreXHR(){this._XHROpen&&(XMLHttpRequest.prototype.open=this._XHROpen)},globalName=globalName||"_rqmgr",window[globalName]=new RequestManager}(window,"_rqmgr");